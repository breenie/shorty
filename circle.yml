---

machine:
    timezone: Europe/London
    node:
        version: 0.12.0
dependencies:
    override:
        - npm install

test:
    override:
        - mkdir -p $CIRCLE_TEST_REPORTS/junit
        - grunt test

deployment:
    production:
        branch: master
        commands:
            # Push to heroku production
            - heroku maintenance:on --app shorty-prod
            - git push git@heroku.com:shorty-prod.git $CIRCLE_SHA1:refs/heads/master
            - heroku maintenance:off --app shorty-prod

    staging:
        branch: develop
        commands:
            # Push to heroku stage
            - heroku maintenance:on --app shorty-stage
            - git push git@heroku.com:shorty-stage.git $CIRCLE_SHA1:refs/heads/master
            - heroku maintenance:off --app shorty-stage
